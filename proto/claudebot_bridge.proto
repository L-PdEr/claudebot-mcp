syntax = "proto3";

package claudebot.bridge;

// ClaudeBot Bridge Service - Remote Claude Code execution with streaming
service BridgeService {
  // Health check (no auth required)
  rpc Health(HealthRequest) returns (HealthResponse);

  // Get bridge status (auth required)
  rpc Status(StatusRequest) returns (StatusResponse);

  // Execute Claude CLI task with server streaming
  rpc Execute(ExecuteRequest) returns (stream ExecuteChunk);

  // Read file from remote server
  rpc ReadFile(FileReadRequest) returns (FileReadResponse);
}

// Health messages
message HealthRequest {}

message HealthResponse {
  string status = 1;
  string service = 2;
}

// Status messages
message StatusRequest {}

message StatusResponse {
  string version = 1;
  bool healthy = 2;
  uint64 requests_processed = 3;
  uint32 active_sessions = 4;
  uint64 uptime_seconds = 5;
}

// Execute messages
message ExecuteRequest {
  string task = 1;
  optional string session_id = 2;
  optional string working_dir = 3;
  int64 chat_id = 4;
  bool autonomous = 5;
}

// Streaming chunk from Claude CLI
message ExecuteChunk {
  ChunkType type = 1;
  string content = 2;
  optional string session_id = 3;
  optional double cost_usd = 4;
  optional uint64 duration_ms = 5;
  bool is_final = 6;
  optional string error = 7;
}

enum ChunkType {
  CHUNK_TYPE_UNSPECIFIED = 0;
  CHUNK_TYPE_ASSISTANT = 1;
  CHUNK_TYPE_SYSTEM = 2;
  CHUNK_TYPE_TOOL_USE = 3;
  CHUNK_TYPE_RESULT = 4;
  CHUNK_TYPE_ERROR = 5;
}

// File messages
message FileReadRequest {
  string path = 1;
  bool analyze = 2;
  uint32 max_bytes = 3;
}

message FileReadResponse {
  bool success = 1;
  string content = 2;
  optional uint64 file_size = 3;
  bool truncated = 4;
  optional string error = 5;
}
